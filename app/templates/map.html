<!DOCTYPE html>
<html lang="en">
<head>
	<meta charset="UTF-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<title>Gas Prices</title>
	<link rel="icon" type="image/x-icon" href="/gas.svg">
	<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" integrity="sha256-20nQCchB9co0qIjJZRGuk2/Z9VM+kNiyxNV1lvTlZBo=" crossorigin=""></script>
	<link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" integrity="sha256-p4NxAoJBhIIN+hmNHrzRCf9tD/miZyoHS5obTRR9BMY=" crossorigin="" />
	<style>
html, body {
	height: 100%;
	margin: 0;
}
#map {
	height: 100vh;
}
.price-marker {
	border-radius: 50%;
	text-align: center;
	width: 40px;
	height: 30px;
	line-height: 30px;
	font-size: 14px;
	font-weight: bold;	
}
.costco {
	background-color: rgba(227, 42, 54, 0.5);
}
.sams {
	background-color: rgba(0, 103, 160, 0.5);
}
	</style>
</head>
<body>
	<div id="map"></div>
<script>
function createPriceIcon(price, color) {
    return L.divIcon({
        className: 'price-icon',
        html: `<div class="price-marker ${color}">$${price}</div>`,
        iconSize: [40, 30]
    });
}

let map = L.map('map').setView([38.25, -85.65], 11);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png').addTo(map);
let layerControl = L.control.layers(null, null, {collapsed: false}).addTo(map);
fetch("gas.csv").then(response => response.text()).then(csv => {
	r = csv.split('\n').map(row => row.split(','));
	stores = ["sams", "costco"]
	storeLayers = [L.layerGroup(), L.layerGroup()];
	i = 0
	for (let s of r) {
		if (s == "") {
			layerControl.addOverlay(storeLayers[i], stores[i]);
			storeLayers[i].addTo(map)
			i++
			continue
		}
		popup="<table><tr><th>Unleaded</th><th>$"+s[0]+"</th></tr><tr><th>Premium</th><th>$"+s[1]+"</th></tr></table>"
		L.marker([s[2], s[3]], { icon: createPriceIcon(s[0], stores[i]) }).bindPopup(popup).addTo(storeLayers[i]);
	}
	layerControl.addOverlay(storeLayers[i], stores[i]);
	storeLayers[i].addTo(map)
})
</script>
</body>
</html>
